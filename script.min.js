function sanitize(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const guardarDiv=document.getElementById("guardar");function renderHistorico(){guardarDiv.innerHTML="";try{const e=localStorage.getItem("historico")||"[]",t=JSON.parse(e);if(!Array.isArray(t))return void console.warn("Hist칩rico inv치lido no localStorage");t.forEach((e,t)=>{if("object"!=typeof e||null===e)return void console.warn(`Entrada inv치lida no hist칩rico: ${t}`);const o=document.createElement("div"),n=sanitize(e.hab1||""),r=sanitize(e.hab2||""),a=sanitize(e.hab3||""),c=sanitize(e.hab4||""),l=sanitize(e.date||""),d=document.createElement("p");d.textContent="九덢잺 "+n;const i=document.createElement("p");i.textContent="九덢잺 "+r;const s=document.createElement("p");s.textContent="九덢잺 "+a;const m=document.createElement("p");m.textContent="九덢잺 "+c;const u=document.createElement("small");u.textContent=l;const g=document.createElement("hr");o.appendChild(d),o.appendChild(i),o.appendChild(s),o.appendChild(m),o.appendChild(u),o.appendChild(g),guardarDiv.appendChild(o)})}catch(e){console.error("Erro ao renderizar hist칩rico:",e)}}function restoreInputs(){try{document.getElementById("hab1").value=localStorage.getItem("hab1")||"",document.getElementById("hab2").value=localStorage.getItem("hab2")||"",document.getElementById("hab3").value=localStorage.getItem("hab3")||"",document.getElementById("hab4").value=localStorage.getItem("hab4")||""}catch(e){console.error("Erro ao restaurar inputs:",e)}}function backupHistorico(){try{const e=localStorage.getItem("historico");null!==e&&localStorage.setItem("historico_backup",e)}catch(e){console.warn("N칚o foi poss칤vel criar backup do hist칩rico",e)}}function undoClear(){try{const e=localStorage.getItem("historico_backup");if(!e)return void alert("Nenhum backup dispon칤vel.");localStorage.setItem("historico",e),localStorage.removeItem("historico_backup"),renderHistorico(),alert("Hist칩rico restaurado.")}catch(e){console.error("Erro ao desfazer limpeza:",e),alert("Erro ao desfazer limpeza.")}}function exportHistorico(){try{const e=localStorage.getItem("historico")||"[]",t=new Blob([e],{type:"application/json"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download="historico_habitos.json",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(o)}catch(e){console.error("Erro ao exportar hist칩rico:",e),alert("Erro ao exportar.")}}document.getElementById("undoClear").addEventListener("click",function(){undoClear()}),document.getElementById("exportBtn").addEventListener("click",exportHistorico),document.getElementById("importFile").addEventListener("change",function(e){const t=e.target.files&&e.target.files[0];if(!t)return;const o=new FileReader;o.onload=function(e){try{const t=JSON.parse(e.target.result);if(!Array.isArray(t))return void alert("Arquivo inv치lido. Deve ser um array JSON.");const o=JSON.parse(localStorage.getItem("historico")||"[]").concat(t);localStorage.setItem("historico",JSON.stringify(o)),renderHistorico(),alert("Importa칞칚o conclu칤da.")}catch(e){console.error("Erro ao importar:",e),alert("Erro ao importar. Veja o console.")}},o.readAsText(t),e.target.value=""});const originalClearHandler=document.getElementById("clearHistory").onclick;function createConfettiCanvas(){let e=document.getElementById("confetti-canvas");return e||(e=document.createElement("canvas"),e.id="confetti-canvas",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex=9999,document.body.appendChild(e)),e}function showConfetti(e=1500){const t=createConfettiCanvas(),o=t.getContext("2d"),n=t.width=window.innerWidth,r=t.height=window.innerHeight,a=[];for(let e=0;e<80;e++)a.push({x:Math.random()*n,y:Math.random()*r-r,r:6*Math.random()+4,d:40*Math.random()+10,c:["#ff595e","#ffca3a","#8ac926","#1982c4","#6a4c93"][Math.floor(5*Math.random())],vx:2*(Math.random()-.5),vy:3*Math.random()+2});const c=performance.now();requestAnimationFrame(function t(l){const d=l-c;o.clearRect(0,0,n,r),a.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.vy+=.05,o.fillStyle=e.c,o.fillRect(e.x,e.y,e.r,.6*e.r)}),d<e?requestAnimationFrame(t):o.clearRect(0,0,n,r)})}document.getElementById("clearHistory").addEventListener("click",function(){if(backupHistorico(),confirm("Tem certeza que deseja limpar o hist칩rico? Esta a칞칚o n칚o pode ser desfeita."))try{localStorage.removeItem("historico"),localStorage.removeItem("done1"),localStorage.removeItem("done2"),localStorage.removeItem("done3"),localStorage.removeItem("done4"),renderHistorico(),document.getElementById("res1").textContent="",document.getElementById("res2").textContent="",document.getElementById("res3").textContent="",document.getElementById("res4").textContent=""}catch(e){console.error("Erro ao limpar hist칩rico:",e),alert("N칚o foi poss칤vel limpar o hist칩rico. Veja o console.")}});const beepAudio=new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA="),oldSaveBtn=document.getElementById("salvar");function restoreChecks(){try{"true"===localStorage.getItem("done1")&&(document.getElementById("res1").textContent="九덢잺"),"true"===localStorage.getItem("done2")&&(document.getElementById("res2").textContent="九덢잺"),"true"===localStorage.getItem("done3")&&(document.getElementById("res3").textContent="九덢잺"),"true"===localStorage.getItem("done4")&&(document.getElementById("res4").textContent="九덢잺")}catch(e){console.error("Erro ao restaurar checks:",e)}}function applyFunMode(e){e?document.body.classList.add("fun"):document.body.classList.remove("fun")}oldSaveBtn.addEventListener("click",function(){try{showConfetti(1200),beepAudio.play().catch(()=>{})}catch(e){}}),["botao1","botao2","botao3","botao4"].forEach(e=>{document.getElementById(e).addEventListener("click",function(){try{beepAudio.play().catch(()=>{})}catch(e){}})}),document.addEventListener("keydown",function(e){e.ctrlKey&&"s"===e.key.toLowerCase()&&(e.preventDefault(),document.getElementById("salvar").click()),e.ctrlKey&&e.shiftKey&&"f"===e.key.toLowerCase()&&(e.preventDefault(),document.getElementById("toggleFun").click()),e.ctrlKey&&"e"===e.key.toLowerCase()&&(e.preventDefault(),document.getElementById("exportBtn").click())}),document.getElementById("botao1").addEventListener("click",()=>{document.getElementById("res1").textContent="九덢잺";try{localStorage.setItem("done1","true")}catch(e){console.error("Erro ao salvar done1:",e)}}),document.getElementById("botao2").addEventListener("click",()=>{document.getElementById("res2").textContent="九덢잺";try{localStorage.setItem("done2","true")}catch(e){console.error("Erro ao salvar done2:",e)}}),document.getElementById("botao3").addEventListener("click",()=>{document.getElementById("res3").textContent="九덢잺";try{localStorage.setItem("done3","true")}catch(e){console.error("Erro ao salvar done3:",e)}}),document.getElementById("botao4").addEventListener("click",()=>{document.getElementById("res4").textContent="九덢잺";try{localStorage.setItem("done4","true")}catch(e){console.error("Erro ao salvar done4:",e)}}),document.getElementById("salvar").addEventListener("click",function(){try{const e=document.getElementById("hab1").value.trim(),t=document.getElementById("hab2").value.trim(),o=document.getElementById("hab3").value.trim(),n=document.getElementById("hab4").value.trim();localStorage.setItem("hab1",e),localStorage.setItem("hab2",t),localStorage.setItem("hab3",o),localStorage.setItem("hab4",n);const r=localStorage.getItem("historico")||"[]",a=JSON.parse(r);Array.isArray(a)&&(a.push({hab1:e,hab2:t,hab3:o,hab4:n,date:(new Date).toLocaleString()}),localStorage.setItem("historico",JSON.stringify(a))),renderHistorico(),document.getElementById("hab1").value="",document.getElementById("hab2").value="",document.getElementById("hab3").value="",document.getElementById("hab4").value="",document.getElementById("hab1").focus()}catch(e){console.error("Erro ao salvar h치bitos:",e),alert("Erro ao salvar h치bitos. Verifique o console.")}}),document.getElementById("clearHistory").addEventListener("click",function(){if(confirm("Tem certeza que deseja limpar o hist칩rico? Esta a칞칚o n칚o pode ser desfeita."))try{localStorage.removeItem("historico"),localStorage.removeItem("done1"),localStorage.removeItem("done2"),localStorage.removeItem("done3"),localStorage.removeItem("done4"),renderHistorico(),document.getElementById("res1").textContent="",document.getElementById("res2").textContent="",document.getElementById("res3").textContent="",document.getElementById("res4").textContent=""}catch(e){console.error("Erro ao limpar hist칩rico:",e),alert("N칚o foi poss칤vel limpar o hist칩rico. Veja o console.")}}),document.getElementById("toggleFun").addEventListener("click",function(){try{const e="true"===localStorage.getItem("funMode");localStorage.setItem("funMode",(!e).toString()),applyFunMode(!e),this.textContent=e?"Modo Divertido 游꿀":"Modo Normal"}catch(e){console.error("Erro ao alternar modo divertido:",e)}}),document.addEventListener("DOMContentLoaded",function(){try{const e="true"===localStorage.getItem("funMode");applyFunMode(e);const t=document.getElementById("toggleFun");t&&(t.textContent=e?"Modo Normal":"Modo Divertido 游꿀")}catch(e){console.error("Erro ao aplicar modo divertido no carregamento:",e)}}),document.addEventListener("DOMContentLoaded",function(){restoreInputs(),restoreChecks(),renderHistorico()});